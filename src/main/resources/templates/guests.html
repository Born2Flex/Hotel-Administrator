<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel management</title>
    <link th:replace="~{fragments/bootstrap :: bootstrap}"/>
</head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="order-md-1">
                <h4 class="mb-3">Check-in</h4>
                <form id="checkInForm" class="needs-validation" novalidate="">
                    <div class="mb-3">
                        <label for="guestType">Guest Type</label>
                        <select class="custom-select d-block w-100" id="guestType" required="">
                            <option value="">Choose...</option>
                            <option value="new">New Guest</option>
                            <option value="existing">Existing Guest</option>
                        </select>
                        <div class="invalid-feedback">
                            Please select a guest type.
                        </div>
                    </div>

                    <!-- New Guest Registration Section -->
                    <div id="newGuestSection" style="display: none;">
                        <div class="mb-3">
                            <label for="firstName">First Name</label>
                            <input type="text" class="form-control" id="firstName" required="">
                            <div class="invalid-feedback">
                                Please enter a first name.
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="lastName">Last Name</label>
                            <input type="text" class="form-control" id="lastName" required="">
                            <div class="invalid-feedback">
                                Please enter a last name.
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="phoneNumber">Phone Number</label>
                            <input type="tel" class="form-control" id="phoneNumber" required="">
                            <div class="invalid-feedback">
                                Please enter a valid phone number.
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" required="">
                            <div class="invalid-feedback">
                                Please enter a valid email address.
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="passport">Passport</label>
                            <input type="text" class="form-control" id="passport" required="">
                            <div class="invalid-feedback">
                                Please enter a passport number.
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#newGuestModal">
                        Register New Guest
                    </button>
                    <form th:replace="~{fragments/create-guest-popup :: create-guest}"></form>
                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            const saveGuestBtn = document.getElementById('saveGuestBtn');
                            const newGuestForm = document.getElementById('newGuestForm');

                            saveGuestBtn.addEventListener('click', function () {
                                if (newGuestForm.checkValidity()) {
                                    console.log('Form is valid. Submitting...');
                                } else {
                                    // Form is invalid, display error messages
                                    console.log('Form is invalid. Please check your input.');
                                    newGuestForm.classList.add('was-validated');
                                }
                            });
                        });
                    </script>

                    <!-- Existing Guest Search Section -->
                    <div id="existingGuestSection" style="display: none;">
                        <div class="mb-3">
                            <label for="searchGuest">Search Guest</label>
                            <input type="text" class="form-control" id="searchGuest">
                            <!-- Add button to trigger guest search -->
                        </div>
                        <!-- Display search results dynamically -->
                    </div>

                    <div class="mb-3">
                        <label for="room">Room</label>
                        <select class="custom-select d-block w-100" id="room" required="">
                            <option value="">Choose...</option>
                            <!-- Populate options dynamically with available rooms -->
                        </select>
                        <div class="invalid-feedback">
                            Please select a room.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="startDate">Start Date</label>
                        <input type="date" class="form-control" id="startDate" required="">
                        <div class="invalid-feedback">
                            Please select a start date.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="endDate">End Date</label>
                        <input type="date" class="form-control" id="endDate" required="">
                        <div class="invalid-feedback">
                            Please select an end date.
                        </div>
                    </div>
                    <hr class="mb-4">
                    <button class="btn btn-primary btn-lg btn-block" type="submit">Check-in</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const checkInForm = document.getElementById('checkInForm');
        const guestTypeSelect = document.getElementById('guestType');
        const newGuestSection = document.getElementById('newGuestSection');
        const existingGuestSection = document.getElementById('existingGuestSection');
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');

        guestTypeSelect.addEventListener('change', function () {
            if (guestTypeSelect.value === 'new') {
                newGuestSection.style.display = 'block';
                existingGuestSection.style.display = 'none';
            } else if (guestTypeSelect.value === 'existing') {
                newGuestSection.style.display = 'none';
                existingGuestSection.style.display = 'block';
            } else {
                newGuestSection.style.display = 'none';
                existingGuestSection.style.display = 'none';
            }
        });

        checkInForm.addEventListener('submit', function (event) {
            if (!checkInForm.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }

            if (guestTypeSelect.value === 'new') {
                // Validate new guest fields
                const firstName = document.getElementById('firstName').value;
                const lastName = document.getElementById('lastName').value;
                const phoneNumber = document.getElementById('phoneNumber').value;
                const email = document.getElementById('email').value;
                const passport = document.getElementById('passport').value;

                if (!firstName || !lastName || !phoneNumber || !email || !passport) {
                    event.preventDefault();
                    event.stopPropagation();
                    return;
                }
            } else if (guestTypeSelect.value === 'existing') {
                // Validate existing guest search
                const searchGuest = document.getElementById('searchGuest').value;

                if (!searchGuest) {
                    event.preventDefault();
                    event.stopPropagation();
                    return;
                }
            }

            // Validate date range
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            if (endDate <= startDate) {
                event.preventDefault();
                event.stopPropagation();
            }
            checkInForm.classList.add('was-validated');
        });
    });
</script>

</body>
</html>
